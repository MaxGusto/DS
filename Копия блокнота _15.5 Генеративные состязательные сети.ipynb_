{"cells":[{"cell_type":"markdown","id":"27636408","metadata":{"heading_collapsed":true,"id":"27636408"},"source":["# Импорт и установка зависимостей"]},{"cell_type":"code","execution_count":1,"id":"b06e37e6","metadata":{"hidden":true,"id":"b06e37e6","executionInfo":{"status":"ok","timestamp":1694546113098,"user_tz":-180,"elapsed":3668,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["import tensorflow as tf\n","#!pip install imageio\n","#!pip install git+https://github.com/tensorflow/docs\n","\n","import glob\n","import imageio\n","import matplotlib.pyplot as plt\n","import numpy as np\n","import os\n","import PIL\n","from tensorflow.keras import layers\n","import time\n","\n","from IPython import display"]},{"cell_type":"markdown","id":"f0d50491","metadata":{"heading_collapsed":true,"id":"f0d50491"},"source":["# Загрузка данных и подготовка"]},{"cell_type":"code","execution_count":2,"id":"981b6fa3","metadata":{"hidden":true,"id":"981b6fa3","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1694546117614,"user_tz":-180,"elapsed":1542,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}},"outputId":"41663249-f026-4425-9443-a02ae88c5de2"},"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz\n","11490434/11490434 [==============================] - 0s 0us/step\n"]}],"source":["(train_images, train_labels), (_, _) = tf.keras.datasets.mnist.load_data() # загружаем данные"]},{"cell_type":"code","execution_count":3,"id":"ab035393","metadata":{"hidden":true,"id":"ab035393","executionInfo":{"status":"ok","timestamp":1694546121785,"user_tz":-180,"elapsed":1166,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["train_images = train_images.reshape(train_images.shape[0], 28, 28, 1).astype('float32')\n","train_images = (train_images - 255) / 255  # Нормализуем изображения"]},{"cell_type":"code","execution_count":4,"id":"f7aab57d","metadata":{"hidden":true,"id":"f7aab57d","executionInfo":{"status":"ok","timestamp":1694546124565,"user_tz":-180,"elapsed":670,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["BUFFER_SIZE = 60000\n","BATCH_SIZE = 256\n","\n","train_dataset = tf.data.Dataset\\\n",".from_tensor_slices(train_images)\\\n",".shuffle(BUFFER_SIZE)\\\n",".batch(BATCH_SIZE) # формируем батчи данных"]},{"cell_type":"markdown","id":"6488b916","metadata":{"heading_collapsed":true,"id":"6488b916"},"source":["# Построение модели"]},{"cell_type":"code","execution_count":5,"id":"27f03648","metadata":{"hidden":true,"id":"27f03648","executionInfo":{"status":"ok","timestamp":1694546127233,"user_tz":-180,"elapsed":1,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["# формируем архитектуру модели генератора, который будет пытаться воссоздать изображение\n","def make_generator_model():\n","    model = tf.keras.Sequential()\n","    model.add(layers.Dense(7*7*256, use_bias=False, input_shape=(100,))) # подается шум на вход\n","    model.add(layers.BatchNormalization())\n","    model.add(layers.LeakyReLU())\n","    model.add(layers.Reshape((7, 7, 256))) # изменяем размерность\n","\n","    model.add(layers.Conv2DTranspose(filters=128,\n","                                     kernel_size=(5, 5),\n","                                     strides=(1, 1),\n","                                     padding='same',\n","                                     use_bias=False)) # делаем upsampling\n","    model.add(layers.BatchNormalization())\n","    model.add(layers.LeakyReLU())\n","\n","    model.add(layers.Conv2DTranspose(filters=64,\n","                                     kernel_size=(5, 5),\n","                                     strides=(2, 2),\n","                                     padding='same',\n","                                     use_bias=False)) # делаем upsampling\n","    model.add(layers.BatchNormalization())\n","    model.add(layers.LeakyReLU())\n","\n","    model.add(layers.Conv2DTranspose(filters=1,\n","                                     kernel_size=(5, 5),\n","                                     strides=(2, 2),\n","                                     padding='same',\n","                                     use_bias=False,\n","                                     activation='tanh')) # делаем upsampling\n","\n","    return model"]},{"cell_type":"code","execution_count":6,"id":"a13fc848","metadata":{"hidden":true,"id":"a13fc848","outputId":"35ee1489-0154-4c3f-94f8-9cc364e03094","colab":{"base_uri":"https://localhost:8080/","height":447},"executionInfo":{"status":"ok","timestamp":1694546133798,"user_tz":-180,"elapsed":1251,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["<matplotlib.image.AxesImage at 0x7f1178b03ac0>"]},"metadata":{},"execution_count":6},{"output_type":"display_data","data":{"text/plain":["<Figure size 640x480 with 1 Axes>"],"image/png":"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XVu3btX06dM9rsy/c+fO6ejRo8rKyvK9FG9yc3OVmZnZ6fwIh8Pas2fPV/78OHHihGpqavrU+REEgZYuXapXXnlF27ZtU25ubqevT548WTExMZ3Oh5KSEpWXl/ep8+GLjsPlHDhwQJJ61vng+yqISLz44otBKBQK1q1bF7z//vvBfffdFwwYMCCorKz0vbSr6h//8R+D7du3B2VlZcH//u//Bvn5+UFaWlpQXV3te2ndqr6+Pnj33XeDd999N5AUPPvss8G7774b/PnPfw6CIAiefvrpYMCAAcHGjRuDgwcPBrfddluQm5sbNDY2el551/q841BfXx888sgjwa5du4KysrJgy5YtwaRJk4JRo0YFTU1NvpfeZR544IEgJSUl2L59e1BRUdFxO3/+fMc2999/fzBkyJBg27Ztwd69e4Pp06cH06dP97jqrvdFx+HIkSPBk08+GezduzcoKysLNm7cGAwfPjyYOXOm55V31isKKAiC4Oc//3kwZMiQIDY2Npg6dWqwe/du30u66u64444gKysriI2NDa677rrgjjvuCI4cOeJ7Wd3uzTffDCR95rZ48eIgCC5eiv2Tn/wkyMjICEKhUDBnzpygpKTE76K7wecdh/Pnzwdz584NBg0aFMTExARDhw4NlixZ0uf+kXa5n19SsHbt2o5tGhsbg3/4h38Irr322iAhISG4/fbbg4qKCn+L7gZfdBzKy8uDmTNnBqmpqUEoFApGjhwZ/NM//VNQV1fnd+GfwtsxAAC86PHPAQEA+iYKCADgBQUEAPCCAgIAeEEBAQC8oIAAAF5QQAAALyggAIAXFBAAwAsKCADgBQUEAPCCAgIAePF/9P0K+LWCxBwAAAAASUVORK5CYII=\n"},"metadata":{}}],"source":["generator = make_generator_model() # инициализируем генератор\n","noise = tf.random.normal([1, 100]) #  шум\n","generated_image = generator(noise)  # картинка, генерируемая необученным генератором\n","\n","plt.imshow(generated_image[0, :, :, 0], cmap='gray')"]},{"cell_type":"code","execution_count":7,"id":"3ac936e3","metadata":{"hidden":true,"id":"3ac936e3","executionInfo":{"status":"ok","timestamp":1694546137196,"user_tz":-180,"elapsed":248,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["# Определяем архитектуру дискриминатора, который будет распознавать оригинальное изображение или нет\n","def make_discriminator_model():\n","    model = tf.keras.Sequential()\n","    model.add(layers.Conv2D(filters=64,\n","                            kernel_size=(5, 5),\n","                            strides=(2, 2),\n","                            padding='same',\n","                            input_shape=[28, 28, 1]))\n","    model.add(layers.LeakyReLU())\n","    model.add(layers.Dropout(0.3))\n","\n","    model.add(layers.Conv2D(128, (5, 5), strides=(2, 2), padding='same'))\n","    model.add(layers.LeakyReLU())\n","    model.add(layers.Dropout(0.3))\n","\n","    model.add(layers.Flatten())\n","    model.add(layers.Dense(1))\n","\n","    return model"]},{"cell_type":"code","execution_count":8,"id":"4d0dea57","metadata":{"hidden":true,"id":"4d0dea57","outputId":"1ff1555f-8352-45a9-8bf0-3f2d7d72fc24","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1694546139516,"user_tz":-180,"elapsed":239,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["tf.Tensor([[0.00246946]], shape=(1, 1), dtype=float32)\n"]}],"source":["discriminator = make_discriminator_model() # определяем дискриминатор\n","decision = discriminator(generated_image) # предсказание еще не тренированным дискриминатором\n","print(decision)"]},{"cell_type":"code","execution_count":9,"id":"8c05311d","metadata":{"hidden":true,"id":"8c05311d","executionInfo":{"status":"ok","timestamp":1694546140712,"user_tz":-180,"elapsed":2,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["loss = tf.keras.losses.BinaryCrossentropy(from_logits=True)\n","\n","# определим функции потерь генератора и дискриминатора\n","def discriminator_loss(real_output, fake_output):\n","    real_loss = loss(tf.ones_like(real_output), real_output) # потери для реальных изображений\n","    fake_loss = loss(tf.zeros_like(fake_output), fake_output)# потери для фейковых изображений\n","    total_loss = real_loss + fake_loss # суммарные потери\n","    return total_loss\n","\n","def generator_loss(fake_output):\n","    return loss(tf.ones_like(fake_output), fake_output) # насколько сгенирируемое похоже на реальное\n","\n","generator_optimizer = tf.keras.optimizers.Adam(1e-4)\n","discriminator_optimizer = tf.keras.optimizers.Adam(1e-4)"]},{"cell_type":"code","execution_count":10,"id":"5af98e75","metadata":{"hidden":true,"id":"5af98e75","executionInfo":{"status":"ok","timestamp":1694546142862,"user_tz":-180,"elapsed":2,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["checkpoint_dir = './training_checkpoints'\n","checkpoint_prefix = os.path.join(checkpoint_dir, \"ckpt\") # путь для сохранения промежуточных результатов\n","checkpoint = tf.train.Checkpoint(generator_optimizer=generator_optimizer,\n","                                 discriminator_optimizer=discriminator_optimizer,\n","                                 generator=generator,\n","                                 discriminator=discriminator) # сохранение промежуточных моделей"]},{"cell_type":"code","execution_count":11,"id":"f8d5c879","metadata":{"hidden":true,"id":"f8d5c879","executionInfo":{"status":"ok","timestamp":1694546144497,"user_tz":-180,"elapsed":2,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["# Тренировка модели\n","\n","EPOCHS = 50\n","noise_dim = 100\n","num_examples_to_generate = 16\n","\n","seed = tf.random.normal([num_examples_to_generate, noise_dim]) # генерация шума на вход генератору"]},{"cell_type":"code","execution_count":12,"id":"ef5e56e4","metadata":{"hidden":true,"id":"ef5e56e4","executionInfo":{"status":"ok","timestamp":1694546146442,"user_tz":-180,"elapsed":238,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["@tf.function\n","def train_step(images): # определим шаг обучения\n","    noise = tf.random.normal([BATCH_SIZE, noise_dim])\n","\n","    with tf.GradientTape() as gen_tape, tf.GradientTape() as disc_tape:\n","        generated_images = generator(noise, training=True)\n","\n","        real_output = discriminator(images, training=True)\n","        fake_output = discriminator(generated_images, training=True)\n","\n","        gen_loss = generator_loss(fake_output)\n","        disc_loss = discriminator_loss(real_output, fake_output)\n","\n","    gradients_of_generator = gen_tape.gradient(gen_loss,\n","                                               generator.trainable_variables)\n","    gradients_of_discriminator = disc_tape.gradient(disc_loss,\n","                                                    discriminator.trainable_variables)\n","\n","    generator_optimizer.apply_gradients(zip(gradients_of_generator,\n","                                            generator.trainable_variables))\n","    discriminator_optimizer.apply_gradients(zip(gradients_of_discriminator,\n","                                                discriminator.trainable_variables))"]},{"cell_type":"code","execution_count":13,"id":"30f9c5c6","metadata":{"hidden":true,"id":"30f9c5c6","executionInfo":{"status":"ok","timestamp":1694546148595,"user_tz":-180,"elapsed":645,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["def train(dataset, epochs):\n","    for epoch in range(epochs):\n","        start = time.time()\n","\n","        for image_batch in dataset:\n","            train_step(image_batch)\n","\n","    # Produce images for the GIF as you go\n","    display.clear_output(wait=True)\n","    generate_and_save_images(generator,\n","                             epoch + 1,\n","                             seed)\n","\n","    # Save the model every 15 epochs\n","    if (epoch + 1) % 15 == 0:\n","        checkpoint.save(file_prefix = checkpoint_prefix)\n","\n","    print ('Time for epoch {} is {} sec'.format(epoch + 1, time.time()-start))\n","\n","    # Generate after the final epoch\n","    display.clear_output(wait=True)\n","    generate_and_save_images(generator, epochs, seed)"]},{"cell_type":"code","execution_count":14,"id":"9883019e","metadata":{"hidden":true,"id":"9883019e","executionInfo":{"status":"ok","timestamp":1694546150839,"user_tz":-180,"elapsed":258,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["def generate_and_save_images(model, epoch, test_input):\n","\n","    predictions = model(test_input, training=False) # не тренируем слои\n","\n","    fig = plt.figure(figsize=(4, 4))\n","    for i in range(predictions.shape[0]):\n","        plt.subplot(4, 4, i+1)\n","        plt.imshow(predictions[i, :, :, 0] * 255 + 255, cmap='gray')\n","        plt.axis('off')\n","\n","    plt.savefig('image_at_epoch_{:04d}.png'.format(epoch))\n","    plt.show()"]},{"cell_type":"code","execution_count":null,"id":"87b82558","metadata":{"hidden":true,"id":"87b82558"},"outputs":[],"source":["train(train_dataset, EPOCHS)"]},{"cell_type":"code","execution_count":null,"id":"d70f101c","metadata":{"hidden":true,"id":"d70f101c","executionInfo":{"status":"aborted","timestamp":1694546316126,"user_tz":-180,"elapsed":3,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["def display_image(epoch_no):\n","    return PIL.Image.open('image_at_epoch_{:04d}.png'.format(epoch_no))"]},{"cell_type":"code","execution_count":null,"id":"9fa3d09d","metadata":{"hidden":true,"id":"9fa3d09d","executionInfo":{"status":"aborted","timestamp":1694546316126,"user_tz":-180,"elapsed":3,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["anim_file = 'dcgan.gif'\n","\n","with imageio.get_writer(anim_file, mode='I') as writer:\n","    filenames = glob.glob('image*.png')\n","    filenames = sorted(filenames)\n","    for filename in filenames:\n","        image = imageio.imread(filename)\n","        writer.append_data(image)\n","    image = imageio.imread(filename)\n","    writer.append_data(image)"]},{"cell_type":"code","execution_count":null,"id":"f7f6356d","metadata":{"hidden":true,"id":"f7f6356d","executionInfo":{"status":"aborted","timestamp":1694546316126,"user_tz":-180,"elapsed":2,"user":{"displayName":"Максим Густомясов","userId":"13875018182189485230"}}},"outputs":[],"source":["import tensorflow_docs.vis.embed as embed\n","embed.embed_file(anim_file)"]}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.4"},"colab":{"provenance":[{"file_id":"1BYbYEcnOXOEQ0_4bgVMM_XI3QYjF0U-z","timestamp":1694546025019}]}},"nbformat":4,"nbformat_minor":5}